<!DOCTYPE html>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="support/helper.sub.js"></script>

<meta http-equiv="Content-Security-Policy" content="trusted-types">
<body>
<div id="container"></div>
<script>
var container = document.querySelector('#container');

// TODO: Does not work - onclickTest definition? C++ implementation?
// Trusted Type assignments do not throw.
async_test(t => {
  window.onclickTest = t.step_func_done();
  let policy = createScript_policy(window, 'onclick');
  let script = policy.createScript("window.onclickTest();");

  let el = document.createElement('a');
  el.setAttribute('onclick', script);
  container.appendChild(el);
  el.click();
}, "a.onclick assigned via policy (successful Script transformation).");

// TODO: Does it work correctly?
// String assignments throw.
async_test(t => {
  window.onclickTest = t.unreached_func("This should not be called.");

  let el = document.createElement('a');
  el.setAttribute('onclick', 'window.onlickTest();');
  container.appendChild(el);
  el.click();

  t.step_timeout(_ => {
    t.done();
  }, 100);
}, "`a.onclick = string` throws.");

// TODO: Does it work correctly?
// Null assignment throws.
async_test(t => {
  let el = document.createElement('a');
  el.setAttribute('onclick', null);
  container.appendChild(el);
  el.click();

  t.step_timeout(_ => {
    t.done();
  }, 100);
}, "`a.onclick = null` throws.");
</script>
